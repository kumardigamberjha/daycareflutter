workflows:
  ios-build:
    name: iOS Build
    environment:
      xcode: latest  # Use the latest available Xcode version
      cocoapods: default  # Ensure Cocoapods is installed if needed
    scripts:
      - name: Install dependencies
        script: |
          # Install any project dependencies
          gem install bundler
          bundle install
          pod install

      - name: Set up automatic code signing
        script: |
          echo "Setting up automatic code signing..."
          xcode-project use-profiles  # Automatically set up provisioning profiles for the project

      - name: Use autogenerated Xcode scheme
        script: |
          echo "Using autogenerated Xcode scheme..."
          xcode-project use-autogenerated-scheme  # Let Codemagic auto-generate the scheme

      - name: Build for iOS
        script: |
          xcodebuild -workspace Runner.xcworkspace \
            -configuration Release \
            -sdk iphoneos \
            -archivePath $CM_BUILD_DIR/Runner.xcarchive \
            archive

      - name: Export archive
        script: |
          xcodebuild -exportArchive \
            -archivePath $CM_BUILD_DIR/Runner.xcarchive \
            -exportOptionsPlist ExportOptions.plist \
            -exportPath $CM_BUILD_DIR

    artifacts:
      - $CM_BUILD_DIR/Runner.xcarchive
      - $CM_BUILD_DIR/Runner.ipa

    publishing:
      email:
        recipients:
          - kumardigamberjha@gmail.com  # Set your notification email here

artifacts:
  - $CM_BUILD_DIR/Runner.ipa  # This is the final IPA file you can download
